{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Categorias - Biblioteca Acadêmica</title>
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap">
	<script src="https://kit.fontawesome.com/9ca5555edc.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="{% static 'usuario/css/responsive.css' %}">
	<link rel="stylesheet" href="{% static 'usuario/css/index.css' %}">
	<link rel="stylesheet" href="{% static 'usuario/aluno/css/styles-aluno.css' %}">
	<link rel="stylesheet" href="{% static 'livro/css/styles-livro.css' %}">
</head>

<body>
	<header>
		{% if user_context.aluno %}
			{% include 'usuario/aluno/parciais/_nav.html' %}
		{% elif user_context.professor %}
			{% include 'usuario/professor/parciais/_nav.html' %}
		{% elif user_context.funcionario %}
			{% include 'usuario/funcionario/parciais/_nav.html' %}
		{% endif %}
	</header>

	<main class="books-page">
		<div class="container-fluid">
			<!-- Page Header -->
			<section class="page-header" style="margin-bottom: 20px;">
				<div class="page-header-content">
					<div class="page-breadcrumb">
						<a href="{% url 'usuario:pagina_inicial_aluno' user.id %}">
							<i class="fa-solid fa-home"></i> Dashboard
						</a>
						<i class="fa-solid fa-chevron-right"></i>
						<span>Categorias</span>
					</div>
					<h1 class="font-display page-title">
						<i class="fa-solid fa-layer-group"></i>
						Categorias de Livros
					</h1>
					<p class="page-subtitle">
						Explore as categorias disponíveis e encontre livros relacionados a cada área do conhecimento.
					</p>
				</div>
			</section>

			<!-- Search Section -->
			<section class="search-section">
				<div class="search-card">
					<form action="{% url 'livro:listar_categorias' %}" method="GET" class="search-form">
						<div class="search-input-wrapper">
							<i class="fa-solid fa-magnifying-glass search-icon"></i>
							<input 
								type="text" 
								name="pesquisa" 
								placeholder="Buscar por nome da categoria..." 
								value="{{ termo_busca }}"
								class="search-input"
								autocomplete="off"
							>
							{% if termo_busca %}
								<a href="{% url 'livro:listar_categorias' %}" class="clear-search" title="Limpar busca">
									<i class="fa-solid fa-xmark"></i>
								</a>
							{% endif %}
						</div>
						<button type="submit" class="btn btn-primary btn-search">
							<i class="fa-solid fa-search"></i>
							<span>Pesquisar</span>
						</button>
					</form>

					{% if termo_busca %}
						<div class="search-results-info">
							<i class="fa-solid fa-circle-info"></i>
							Exibindo resultados para "<strong>{{ termo_busca }}</strong>"
							{% if categorias.paginator.count %}
								- {{ categorias.paginator.count }} categoria{{ categorias.paginator.count|pluralize }}
							{% endif %}
						</div>
					{% endif %}
				</div>
			</section>

			<!-- Categories List Section -->
			<section class="books-section">
				{% if categorias %}
					<div class="books-list">
						{% for categoria in categorias %}
							<div class="book-card">
								<div class="book-card-header">
									<div class="book-icon">
										<i class="fa-solid fa-layer-group"></i>
									</div>
								</div>
								<div class="book-card-body">
									<h3 class="book-title">
										<a href="{% url 'livro:listar_livros' %}?categoria={{ categoria.id }}">
											{{ categoria.categoria }}
										</a>
									</h3>
									<div class="book-meta">
										<div class="book-meta-item">
											<i class="fa-solid fa-book"></i>
											<span>{{ categoria.livros_count }} livro{{ categoria.livros_count|pluralize }} nesta categoria</span>
										</div>
										{% if categoria.descricao %}
										<div class="book-meta-item">
											<i class="fa-solid fa-info-circle"></i>
											<span>{{ categoria.descricao }}</span>
										</div>
										{% endif %}
									</div>
								</div>
								<div class="book-card-footer" style="display: flex; justify-content: space-between; flex-direction: row;">
									<a href="{% url 'livro:listar_livros' %}?categoria={{ categoria.id }}" class="btn btn-outline-primary btn-sm">
										<i class="fa-solid fa-eye"></i>
										Ver Livros
									</a>
									<a href="{% url 'livro:detalhar_categoria' categoria.id %}" class="btn btn-outline-primary btn-sm">
										<i class="fa-solid fa-eye"></i>
										Detalhes da Categoria
									</a>
								</div>
							</div>
						{% endfor %}
					</div>

					<!-- Pagination -->
					{% if categorias.paginator.num_pages > 1 %}
						<div class="pagination-section">
							<nav class="pagination-nav">
								{% if categorias.has_previous %}
									<a href="?pesquisa={{ termo_busca }}&page=1" class="pagination-btn pagination-btn-first">
										<i class="fa-solid fa-angles-left"></i>
										<span class="d-none d-sm-inline">Primeira</span>
									</a>
									<a href="?pesquisa={{ termo_busca }}&page={{ categorias.previous_page_number }}" class="pagination-btn">
										<i class="fa-solid fa-chevron-left"></i>
										<span class="d-none d-sm-inline">Anterior</span>
									</a>
								{% else %}
									<button class="pagination-btn pagination-btn-first" disabled>
										<i class="fa-solid fa-angles-left"></i>
										<span class="d-none d-sm-inline">Primeira</span>
									</button>
									<button class="pagination-btn" disabled>
										<i class="fa-solid fa-chevron-left"></i>
										<span class="d-none d-sm-inline">Anterior</span>
									</button>
								{% endif %}

								<div class="pagination-info">
									<span class="pagination-current">Página {{ categorias.number }}</span>
									<span class="pagination-separator">de</span>
									<span class="pagination-total">{{ categorias.paginator.num_pages }}</span>
								</div>

								{% if categorias.has_next %}
									<a href="?pesquisa={{ termo_busca }}&page={{ categorias.next_page_number }}" class="pagination-btn">
										<span class="d-none d-sm-inline">Próxima</span>
										<i class="fa-solid fa-chevron-right"></i>
									</a>
									<a href="?pesquisa={{ termo_busca }}&page={{ categorias.paginator.num_pages }}" class="pagination-btn pagination-btn-last">
										<span class="d-none d-sm-inline">Última</span>
										<i class="fa-solid fa-angles-right"></i>
									</a>
								{% else %}
									<button class="pagination-btn" disabled>
										<span class="d-none d-sm-inline">Próxima</span>
										<i class="fa-solid fa-chevron-right"></i>
									</button>
									<button class="pagination-btn pagination-btn-last" disabled>
										<span class="d-none d-sm-inline">Última</span>
										<i class="fa-solid fa-angles-right"></i>
									</button>
								{% endif %}
							</nav>
						</div>
					{% endif %}

				{% else %}
					<!-- Empty State -->
					<div class="empty-state">
						<div class="empty-state-icon">
							<i class="fa-solid fa-layer-group"></i>
						</div>
						<h2 class="font-display empty-state-title">
							{% if termo_busca %}
								Nenhuma categoria encontrada
							{% else %}
								Nenhuma categoria disponível
							{% endif %}
						</h2>
						<p class="empty-state-text">
							{% if termo_busca %}
								Não encontramos resultados para "{{ termo_busca }}". Tente usar outros termos de busca.
							{% else %}
								As categorias estão sendo atualizadas. Por favor, volte mais tarde.
							{% endif %}
						</p>
						{% if termo_busca %}
							<a href="{% url 'livro:listar_categorias' %}" class="btn btn-primary">
								<i class="fa-solid fa-arrow-left"></i>
								Ver todas as categorias
							</a>
						{% endif %}
					</div>
				{% endif %}
			</section>
		</div>
	</main>

	<script>
	// Mobile menu toggle
	document.addEventListener('DOMContentLoaded', function() {
		const mobileMenuBtn = document.getElementById('mobile-menu-btn');
		const navbarCollapse = document.getElementById('navbarNav');
		const userMenuBtn = document.getElementById('user-menu-btn');
		const userDropdown = document.getElementById('user-dropdown');

		if (mobileMenuBtn && navbarCollapse) {
			mobileMenuBtn.addEventListener('click', function() {
				navbarCollapse.classList.toggle('show');
				this.classList.toggle('active');
			});
		}

		if (userMenuBtn && userDropdown) {
			userMenuBtn.addEventListener('click', function(e) {
				e.stopPropagation();
				userDropdown.classList.toggle('show');
			});

			// Close dropdown when clicking outside
			document.addEventListener('click', function() {
				userDropdown.classList.remove('show');
			});

			userDropdown.addEventListener('click', function(e) {
				e.stopPropagation();
			});
		}
	});
	</script>
</body>

</html>
